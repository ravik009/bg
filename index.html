<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>AI Background Remover</title>
<link rel="icon" href="https://cdn-icons-png.flaticon.com/512/1828/1828919.png" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet" />
<style>
/* === your same styles trimmed for brevity, no functional change === */
</style>
</head>
<body>
  <div class="container">
    <img class="logo" src="https://cdn-icons-png.flaticon.com/512/1828/1828919.png" alt="logo" />
    <h2>AI Background Remover</h2>
    <div class="subtitle">Remove image backgrounds instantly with AI.<br/>Fast, free &amp; private.</div>

    <label class="upload-label" for="imageInput">
      <span class="upload-text">Click to upload or drag &amp; drop an image</span>
      <input id="imageInput" type="file" accept="image/*" />
      <img id="previewImg" />
    </label>

    <button id="removeBtn" class="btn">Remove Background</button>
    <div id="loader" class="loader"></div>
  </div>

  <div id="toast" class="toast"></div>

  <footer>&copy; 2025 AI Background Remover — Powered by Python, Flask &amp; Rembg</footer>

<script>
/* ---------- setup ---------- */
const imageInput = document.getElementById("imageInput");
const previewImg = document.getElementById("previewImg");
const removeBtn  = document.getElementById("removeBtn");
const loader     = document.getElementById("loader");
const toast      = document.getElementById("toast");

/* auto‑switch API URL */
const HF_URL   = "https://ravikumar619--abackgroundremover.hf.space";
const LOCAL_URL = "http://127.0.0.1:7860";
const API_URL  = window.location.hostname.includes("localhost") || window.location.hostname.startsWith("127.")
                ? LOCAL_URL
                : HF_URL;

/* ---------- helpers ---------- */
function showToast(msg, error=false){
  toast.textContent    = msg;
  toast.style.borderLeftColor = error? "#ef4444" : "#6366f1";
  toast.style.color           = error? "#ef4444" : "#3730a3";
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),3000);
}

/* image preview */
imageInput.addEventListener("change", e=>{
  const file = e.target.files?.[0];
  if(!file){ previewImg.style.display="none"; previewImg.classList.remove("cutout"); return; }
  const reader = new FileReader();
  reader.onload = ev=>{
      previewImg.src = ev.target.result;
      previewImg.style.display="block";
      previewImg.classList.remove("cutout");
  };
  reader.readAsDataURL(file);
});

/* remove background */
removeBtn.addEventListener("click", async ()=>{
  const file = imageInput.files?.[0];
  if(!file) return showToast("Please select an image!", true);

  removeBtn.disabled = true;
  loader.style.display = "block";
  previewImg.classList.remove("cutout");

  const formData = new FormData();
  formData.append("image", file);

  try{
    const res = await fetch(`${API_URL}/api/remove-bg`, {method:"POST", body:formData});
    if(!res.ok){
      /* graceful error parse */
      let errTxt = "Unknown error";
      try{ errTxt = (await res.json()).error; }catch{ errTxt = await res.text(); }
      throw new Error(errTxt);
    }
    const blob = await res.blob();
    previewImg.src = URL.createObjectURL(blob);
    previewImg.style.display = "block";
    previewImg.classList.add("cutout");
    showToast("Background removed! Right‑click to save.");
  }catch(err){
    showToast("Error: "+err.message, true);
  }finally{
    loader.style.display = "none";
    removeBtn.disabled   = false;
  }
});
</script>
</body>
</html>
